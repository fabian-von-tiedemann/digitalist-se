---
phase: 01-foundation
plan: 01
type: execute
depends_on: []
files_modified: [package.json, next.config.ts, tsconfig.json, src/app/layout.tsx, src/app/page.tsx, src/lib/directus.ts, .env.local.example]
---

<objective>
Initialize Next.js 14 project with Directus SDK and i18n foundation.

Purpose: Establish the core tech stack that all subsequent phases build upon.
Output: Working Next.js app with Directus client configured, TypeScript, and i18n routing structure.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Tech stack beslut:**
- Framework: Next.js 14 (App Router) — Upsun-native, mature i18n
- CMS: Directus (self-hosted) — Partner, open source, körs på samma Upsun-projekt
- Databas: PostgreSQL — Upsun-stöd, Directus standard
- i18n: next-intl — Robust routing, type-safe translations
- Styling: Tailwind CSS — Rapid prototyping, design token support

**Arkitektur:**
- Next.js och Directus som multi-app på samma Upsun-projekt
- Directus API konsumeras endast av Next.js frontend (fast API-token)
- Assets lagras på Upsun disk mount

**Constraints från PROJECT.md:**
- Upsun.com hosting
- WCAG 2.1 AA compliance
- Svenska först, i18n-ready arkitektur
- Inga SaaS-beroenden — allt open source
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js 14 project with TypeScript</name>
  <files>package.json, next.config.ts, tsconfig.json, src/app/layout.tsx, src/app/page.tsx</files>
  <action>
Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"` with the following answers:
- Would you like to use Turbopack? No (Upsun compatibility)

After creation, verify package.json has next@14.x, react@18.x, tailwindcss.

Update src/app/page.tsx to a minimal placeholder:
```tsx
export default function Home() {
  return (
    <main className="min-h-screen flex items-center justify-center">
      <h1 className="text-4xl font-bold">Digitalist.se</h1>
    </main>
  );
}
```

Update src/app/layout.tsx metadata:
- title: "Digitalist — Suverän AI för offentlig sektor"
- description: "Sveriges enda öppna helhetspartner för suverän AI"
- lang: "sv"
  </action>
  <verify>npm run dev starts without errors, localhost:3000 shows placeholder</verify>
  <done>Next.js 14 app running with TypeScript, Tailwind, ESLint configured</done>
</task>

<task type="auto">
  <name>Task 2: Add Directus SDK and client configuration</name>
  <files>package.json, src/lib/directus.ts, .env.local.example</files>
  <action>
Install Directus SDK:
```bash
npm install @directus/sdk
```

Create src/lib/directus.ts:
```ts
import { createDirectus, rest, staticToken } from '@directus/sdk'

// Define your collections schema (will expand as content model grows)
type Schema = {
  pages: Page[]
  posts: Post[]
}

type Page = {
  id: string
  title: string
  slug: string
  content: string
  status: 'published' | 'draft' | 'archived'
}

type Post = {
  id: string
  title: string
  slug: string
  content: string
  status: 'published' | 'draft' | 'archived'
  date_published: string
}

const directusUrl = process.env.DIRECTUS_URL || 'http://localhost:8055'
const directusToken = process.env.DIRECTUS_API_TOKEN || ''

export const directus = createDirectus<Schema>(directusUrl)
  .with(staticToken(directusToken))
  .with(rest())

export type { Schema, Page, Post }
```

Create .env.local.example:
```
# Directus connection
DIRECTUS_URL=http://127.0.0.1:8055
DIRECTUS_API_TOKEN=your-static-token-here

# For production on Upsun, these will be set via platform variables
```

Note: Directus instance will be set up in Plan 02. This prepares the client.
  </action>
  <verify>npm run build succeeds (SDK installed, types compile)</verify>
  <done>Directus SDK installed, typed client ready for use</done>
</task>

<task type="auto">
  <name>Task 3: Configure i18n routing with next-intl</name>
  <files>package.json, src/i18n.ts, src/middleware.ts, src/app/[locale]/layout.tsx, src/app/[locale]/page.tsx, messages/sv.json, messages/en.json</files>
  <action>
Install next-intl:
```bash
npm install next-intl
```

Create src/i18n.ts:
```ts
import { getRequestConfig } from 'next-intl/server'

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`../messages/${locale}.json`)).default
}))
```

Create src/middleware.ts:
```ts
import createMiddleware from 'next-intl/middleware'

export default createMiddleware({
  locales: ['sv', 'en'],
  defaultLocale: 'sv',
  localePrefix: 'as-needed' // Swedish URLs without /sv prefix
})

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
}
```

Move src/app/page.tsx and layout.tsx to src/app/[locale]/:
- Update layout.tsx to receive locale param and set html lang
- Update page.tsx to use useTranslations hook

Create messages/sv.json:
```json
{
  "home": {
    "title": "Suverän AI för offentlig sektor",
    "subtitle": "Sveriges enda öppna helhetspartner"
  }
}
```

Create messages/en.json:
```json
{
  "home": {
    "title": "Sovereign AI for the public sector",
    "subtitle": "Sweden's only open full-service partner"
  }
}
```

Update next.config.ts to include next-intl plugin:
```ts
import createNextIntlPlugin from 'next-intl/plugin'

const withNextIntl = createNextIntlPlugin()

/** @type {import('next').NextConfig} */
const nextConfig = {}

export default withNextIntl(nextConfig)
```
  </action>
  <verify>npm run dev works, / shows Swedish, /en shows English</verify>
  <done>i18n routing working with Swedish default, English as secondary locale</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` completes successfully
- [ ] localhost:3000 shows Swedish content
- [ ] localhost:3000/en shows English content
- [ ] Directus SDK types compile correctly
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Next.js 14 + Directus SDK + next-intl foundation established
- Ready for Upsun multi-app deployment (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
