---
phase: 01-foundation
plan: 01
type: execute
depends_on: []
files_modified: [package.json, next.config.ts, tsconfig.json, src/app/layout.tsx, src/app/page.tsx, .env.local.example, sanity.config.ts, sanity/schema.ts]
---

<objective>
Initialize Next.js 14 project with Sanity CMS and i18n foundation.

Purpose: Establish the core tech stack that all subsequent phases build upon.
Output: Working Next.js app with Sanity studio, TypeScript, and i18n routing structure.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Tech stack decision (inline discovery):**
- Framework: Next.js 14 (App Router) — Upsun-native, mature i18n, React ecosystem
- CMS: Sanity.io — Visual editing, generous free tier, TypeScript-native
- i18n: next-intl — Robust routing, type-safe translations
- Styling: Tailwind CSS — Rapid prototyping, design token support

**Constraints from PROJECT.md:**
- Upsun.com hosting (Next.js fully supported)
- WCAG 2.1 AA compliance (server-rendering helps)
- Swedish first, i18n-ready architecture
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js 14 project with TypeScript</name>
  <files>package.json, next.config.ts, tsconfig.json, src/app/layout.tsx, src/app/page.tsx</files>
  <action>
Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"` with the following answers:
- Would you like to use Turbopack? No (Upsun compatibility)

After creation, verify package.json has next@14.x, react@18.x, tailwindcss.

Update src/app/page.tsx to a minimal placeholder:
```tsx
export default function Home() {
  return (
    <main className="min-h-screen flex items-center justify-center">
      <h1 className="text-4xl font-bold">Digitalist.se</h1>
    </main>
  );
}
```

Update src/app/layout.tsx metadata:
- title: "Digitalist — Suverän AI för offentlig sektor"
- description: "Sveriges enda öppna helhetspartner för suverän AI"
- lang: "sv"
  </action>
  <verify>npm run dev starts without errors, localhost:3000 shows placeholder</verify>
  <done>Next.js 14 app running with TypeScript, Tailwind, ESLint configured</done>
</task>

<task type="auto">
  <name>Task 2: Add Sanity CMS with embedded studio</name>
  <files>package.json, sanity.config.ts, sanity/schema.ts, src/app/studio/[[...tool]]/page.tsx, .env.local.example</files>
  <action>
Install Sanity dependencies:
```bash
npm install sanity @sanity/vision next-sanity
```

Create sanity.config.ts at root:
```ts
import { defineConfig } from 'sanity'
import { structureTool } from 'sanity/structure'
import { visionTool } from '@sanity/vision'
import { schema } from './sanity/schema'

export default defineConfig({
  name: 'digitalist',
  title: 'Digitalist CMS',
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',
  basePath: '/studio',
  plugins: [structureTool(), visionTool()],
  schema,
})
```

Create sanity/schema.ts with minimal page schema:
```ts
import { type SchemaTypeDefinition } from 'sanity'

const page: SchemaTypeDefinition = {
  name: 'page',
  title: 'Page',
  type: 'document',
  fields: [
    { name: 'title', title: 'Title', type: 'string' },
    { name: 'slug', title: 'Slug', type: 'slug', options: { source: 'title' } },
  ],
}

export const schema = { types: [page] }
```

Create src/app/studio/[[...tool]]/page.tsx:
```tsx
'use client'
import { NextStudio } from 'next-sanity/studio'
import config from '../../../../sanity.config'

export default function StudioPage() {
  return <NextStudio config={config} />
}
```

Create .env.local.example:
```
NEXT_PUBLIC_SANITY_PROJECT_ID=your-project-id
NEXT_PUBLIC_SANITY_DATASET=production
```

Note: User must create Sanity project at sanity.io/manage and add project ID to .env.local before studio works.
  </action>
  <verify>npm run dev starts, /studio route loads (will show config error until env vars set)</verify>
  <done>Sanity studio embedded at /studio, schema structure in place</done>
</task>

<task type="auto">
  <name>Task 3: Configure i18n routing with next-intl</name>
  <files>package.json, src/i18n.ts, src/middleware.ts, src/app/[locale]/layout.tsx, src/app/[locale]/page.tsx, messages/sv.json</files>
  <action>
Install next-intl:
```bash
npm install next-intl
```

Create src/i18n.ts:
```ts
import { getRequestConfig } from 'next-intl/server'

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`../messages/${locale}.json`)).default
}))
```

Create src/middleware.ts:
```ts
import createMiddleware from 'next-intl/middleware'

export default createMiddleware({
  locales: ['sv', 'en'],
  defaultLocale: 'sv',
  localePrefix: 'as-needed' // Swedish URLs without /sv prefix
})

export const config = {
  matcher: ['/((?!api|_next|_vercel|studio|.*\\..*).*)']
}
```

Move src/app/page.tsx and layout.tsx to src/app/[locale]/:
- Update layout.tsx to receive locale param and set html lang
- Update page.tsx to use useTranslations hook

Create messages/sv.json:
```json
{
  "home": {
    "title": "Suverän AI för offentlig sektor",
    "subtitle": "Sveriges enda öppna helhetspartner"
  }
}
```

Create messages/en.json with English translations.

Update next.config.ts to include next-intl plugin.
  </action>
  <verify>npm run dev works, / shows Swedish, /en shows English</verify>
  <done>i18n routing working with Swedish default, English as secondary locale</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` completes successfully
- [ ] localhost:3000 shows Swedish content
- [ ] localhost:3000/en shows English content
- [ ] localhost:3000/studio loads (config placeholder until env set)
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Next.js 14 + Sanity + next-intl foundation established
- Ready for Upsun deployment (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
