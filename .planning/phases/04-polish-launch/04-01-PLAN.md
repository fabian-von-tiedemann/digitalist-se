---
phase: 04-polish-launch
plan: 01
type: execute
depends_on: []
files_modified: [next.config.ts, src/app/[locale]/layout.tsx, src/app/sitemap.ts, src/app/robots.ts, public/_redirects]
domain: next-js
---

<objective>
Configure SEO infrastructure with dynamic meta tags, sitemap, robots.txt, and redirects from old digitalist.se URLs.

Purpose: Ensure search engine visibility and preserve SEO equity from existing site during migration.
Output: Complete SEO configuration with working sitemap, robots.txt, and redirect rules.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior decisions affecting this phase:
- Next.js 15 with App Router (01-01)
- next-intl with localePrefix 'as-needed' for clean Swedish URLs (01-01)
- Swedish default locale, English secondary (01-01)

# Relevant source files:
@src/app/[locale]/layout.tsx
@next.config.ts
@src/middleware.ts
@src/i18n/routing.ts

# Key constraints:
- Swedish URLs without /sv prefix (next-intl as-needed)
- English URLs with /en prefix
- Must preserve SEO from old digitalist.se
- GDPR-friendly (no third-party tracking initially)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dynamic metadata with generateMetadata per page</name>
  <files>src/app/[locale]/layout.tsx, src/app/[locale]/page.tsx, src/app/[locale]/kontakt/page.tsx, src/app/[locale]/case/page.tsx, src/app/[locale]/blogg/page.tsx</files>
  <action>
1. Update layout.tsx with base metadata template:
   - Default title template: "%s | Digitalist"
   - Default description, keywords, author
   - Open Graph base configuration
   - Twitter card configuration
   - Canonical URL with locale handling
   - Add viewport, themeColor metadata

2. Add generateMetadata to each page:
   - page.tsx (home): "Suverän AI för offentlig sektor | Digitalist"
   - kontakt/page.tsx: "Kontakt | Digitalist"
   - case/page.tsx: "Kundcase | Digitalist"
   - blogg/page.tsx: "Blogg | Digitalist"

3. Add alternates for hreflang (sv/en) in each page's metadata

Use Next.js 15 Metadata API. Do NOT use next-seo or third-party libraries.
  </action>
  <verify>npm run build succeeds, check generated HTML has proper meta tags in head</verify>
  <done>All pages have proper title, description, OG tags, and hreflang alternates</done>
</task>

<task type="auto">
  <name>Task 2: Create sitemap.ts and robots.ts</name>
  <files>src/app/sitemap.ts, src/app/robots.ts</files>
  <action>
1. Create src/app/sitemap.ts:
   - Export default function that returns MetadataRoute.Sitemap
   - Include all static pages: /, /kontakt, /case, /blogg
   - Include dynamic pages from mock data: /case/[slug], /blogg/[slug]
   - Add both Swedish (default) and English (/en) versions
   - Set appropriate lastModified dates and changeFrequency
   - Priority: home=1.0, case/blog listings=0.8, individual posts=0.6

2. Create src/app/robots.ts:
   - Export default function returning MetadataRoute.Robots
   - Allow all crawlers for all paths
   - Disallow /api/ paths
   - Reference sitemap URL

Use Next.js 15 App Router conventions. Import getCaseStudies and getBlogPosts from directus.ts for dynamic slugs.
  </action>
  <verify>curl localhost:3000/sitemap.xml shows valid XML, curl localhost:3000/robots.txt shows valid robots</verify>
  <done>sitemap.xml lists all pages with hreflang, robots.txt references sitemap and disallows /api</done>
</task>

<task type="auto">
  <name>Task 3: Configure redirects in next.config.ts</name>
  <files>next.config.ts</files>
  <action>
1. Add redirects() function to nextConfig:
   - Common old URL patterns to new structure
   - /tjanster/* → /case (temporary until service pages exist)
   - /om-oss → /kontakt (temporary)
   - /nyheter/* → /blogg
   - /blog/* → /blogg (English pattern)
   - /aktuellt/* → /blogg

2. Add trailing slash handling (trailingSlash: false)

3. Ensure redirects work with next-intl middleware (order matters)

Note: These are placeholder redirects. Real mapping requires analysis of current digitalist.se URL structure which should be done before launch. Add a TODO comment noting this.
  </action>
  <verify>npm run build succeeds, test a redirect pattern with curl -I</verify>
  <done>Redirect configuration in place, common patterns handled, note for full mapping added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` then curl localhost:3000/sitemap.xml returns valid XML
- [ ] curl localhost:3000/robots.txt shows sitemap reference
- [ ] Browser dev tools show proper meta tags on pages
- [ ] Redirects resolve (test one pattern)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- SEO infrastructure ready for launch
  </success_criteria>

<output>
After completion, create `.planning/phases/04-polish-launch/04-01-SUMMARY.md`
</output>
